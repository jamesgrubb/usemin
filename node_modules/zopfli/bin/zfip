#!/usr/bin/env node
var Path, Fs, Zf, file;
Path = require('path');
Fs = require('fs');
Zf = require(Path.join(__dirname, '..', 'build', 'Release', 'zopfli'));
file = process.argv[2];
Fs.stat(file, function(err, st){
  if (err) {
    throw err;
  }
  if (st.size > 20 * 1024 * 1024) {
    console.error("warning, you could be making a big mistake. you might run out of memory if you open too big of a file!!");
  }
  return Fs.readFile(file, function(err, data){
    var compressed;
    if (err) {
      throw err;
    }
    compressed = Zf.deflateSync(data, {
      gzip: 1
    });
    console.log("file reduced from " + st.size + " -> " + compressed.length);
    return Fs.writeFile(file + '.gz', compressed, 'binary', function(err){
      if (err) {
        throw err;
      }
      return console.log("wrote file " + file + ".gz");
    });
  });
});
