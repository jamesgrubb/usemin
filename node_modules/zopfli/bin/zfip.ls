
Path = require \path
Fs = require \fs
Zf = require Path.join __dirname, \.. \build \Release \zopfli

file = process.argv.2 #Path.join __dirname, \.. \binding.gyp

(err, st) <- Fs.stat file
throw err if err
if st.size > 20 * 1024 * 1024mb
	console.error "warning, you could be making a big mistake. you might run out of memory if you open too big of a file!!"

(err, data) <- Fs.readFile file
throw err if err

#(err, compressed) <- Zf.deflate data, gzip: 1
compressed = Zf.deflateSync data, {gzip: 1}
console.log "file reduced from #{st.size} -> #{compressed.length}"

(err) <- Fs.writeFile file+'.gz', compressed, \binary
throw err if err
console.log "wrote file #{file}.gz"